{% extends "base.html" %}

{% block content %}
<section class="section fade-in">
    <div class="container">
        <div class="row text-center mb-5">
            <div class="col-md-10 mx-auto">
                <h2 class="section-title">Modelo Predictivo H√≠brido: LightGBM Avanzado</h2>
                <p class="section-subtitle">
                    Se implement√≥ un modelo h√≠brido de <strong>4 componentes</strong> basado en LightGBM para predicci√≥n de contaminantes (PM2.5 y PM10). El modelo combina regresi√≥n (valores exactos) y clasificaci√≥n (categor√≠as: Bajo/Medio/Alto) con features meteorol√≥gicas realistas y features derivadas del an√°lisis temporal.
                </p>
            </div>
        </div>

        <!-- Secci√≥n: Metodolog√≠a General -->
        <div class="row mb-5">
            <div class="col-lg-12">
                <div class="card shadow-sm border-success">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">Metodolog√≠a de Entrenamiento y Evaluaci√≥n</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="fw-bold text-success">Preparaci√≥n de Datos</h6>
                                <ul class="small">
                                    <li><strong>Variables de entrada (Features):</strong> 24h hist√≥rico PM + Meteorolog√≠a + Features Derivadas</li>
                                    <li><strong>Features Meteorol√≥gicas:</strong> Temperatura, Humedad, Presi√≥n, Velocidad Viento (realista)</li>
                                    <li><strong>Features Derivadas:</strong> Deltas, Moving Averages (3h, 6h, 12h), Max/Min rolling, Std Dev</li>
                                    <li><strong>Per√≠odo de entrenamiento:</strong> TODO EL A√ëO 2025 (8,760 registros horarios)</li>
                                    <li><strong>Normalizaci√≥n:</strong> MinMaxScaler [0,1] para todas las features</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6 class="fw-bold text-success">Divisi√≥n y Validaci√≥n</h6>
                                <ul class="small">
                                    <li><strong>Train/Test Split:</strong> 75% (6,570) entrenamiento, 25% (2,190) prueba - <strong>Temporal, sin shuffle</strong></li>
                                    <li><strong>Objective (Regresi√≥n):</strong> Regresi√≥n L2 (squared error)</li>
                                    <li><strong>Objective (Clasificaci√≥n):</strong> Multiclass logloss para 3 categor√≠as</li>
                                    <li><strong>Evaluaci√≥n:</strong> R¬≤, RMSE, MAE, MAPE, Accuracy</li>
                                    <li><strong>Early Stopping:</strong> Evaluaci√≥n en validation set</li>
                                </ul>
                            </div>
                        </div>
                        <hr>
                        <h6 class="fw-bold text-success">M√©tricas de Evaluaci√≥n</h6>
                        <div class="row text-center">
                            <div class="col-md-3">
                                <p><strong>RMSE</strong><br><small class="text-muted">Ra√≠z del Error Cuadr√°tico Medio</small></p>
                            </div>
                            <div class="col-md-3">
                                <p><strong>MAE</strong><br><small class="text-muted">Error Absoluto Medio</small></p>
                            </div>
                            <div class="col-md-3">
                                <p><strong>R¬≤ Score</strong><br><small class="text-muted">Coeficiente de Determinaci√≥n</small></p>
                            </div>
                            <div class="col-md-3">
                                <p><strong>MAPE</strong><br><small class="text-muted">Error Porcentual Absoluto Medio</small></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Grid de Modelos -->
        <div class="row g-4">
            <!-- 1. LightGBM PM2.5 Regresi√≥n -->
            <div class="col-lg-6">
                <div class="model-card h-100 border-start border-4 border-success">
                    <div class="model-card-header bg-light">
                        <h5 class="model-title text-success mb-0">LightGBM Regresi√≥n PM2.5</h5>
                        <small class="text-muted">Gradient Boosting para valores exactos</small>
                    </div>
                    <div class="model-card-graphic bg-success bg-opacity-10 rounded d-flex align-items-center justify-content-center" style="height: 120px; min-height: 120px;">
                        <div class="text-center">
                            <div style="font-size: 3rem; margin-bottom: 8px;">üìä</div>
                            <p class="small text-muted mb-0"><strong>R¬≤ = 0.8819</strong></p>
                            <p class="small text-muted mb-0">RMSE = 0.641 ug/m¬≥</p>
                        </div>
                    </div>
                    <div class="model-card-body">
                        <h6 class="fw-bold">¬øC√≥mo funciona?</h6>
                        <p class="small">Construye √°rboles de decisi√≥n de forma secuencial, donde cada nuevo √°rbol corrige los residuos del anterior mediante descenso de gradiente. LightGBM optimiza esta estrategia usando hojas de crecimiento √≥ptimas (leaf-wise) para mejor precisi√≥n.</p>

                        <h6 class="fw-bold mt-3">Par√°metros Clave</h6>
                        <ul class="small list-unstyled">
                            <li>‚Ä¢ <strong>num_leaves:</strong> 50 (m√°s capacidad que max_depth)</li>
                            <li>‚Ä¢ <strong>learning_rate:</strong> 0.05 (aprendizaje lento pero preciso)</li>
                            <li>‚Ä¢ <strong>num_boost_round:</strong> 300 (iteraciones de boosting)</li>
                            <li>‚Ä¢ <strong>max_depth:</strong> 10 (profundidad m√°xima de √°rbol)</li>
                        </ul>

                        <h6 class="fw-bold mt-3">Features Utilizadas</h6>
                        <ul class="small">
                            <li>‚úì 24 horas de hist√≥rico PM2.5</li>
                            <li>‚úì Temperatura, Humedad, Presi√≥n, Viento (realista)</li>
                            <li>‚úì Features derivadas (deltas, moving avg, max/min)</li>
                            <li>‚úì Features temporales (hora, d√≠a, mes, estaci√≥n)</li>
                        </ul>

                        <h6 class="fw-bold mt-3">Desempe√±o</h6>
                        <ul class="small">
                            <li>‚úì <strong>R¬≤:</strong> 0.8819 (88% varianza explicada)</li>
                            <li>‚úì <strong>RMSE:</strong> 0.641 ug/m¬≥</li>
                            <li>‚úì <strong>MAE:</strong> 0.505 ug/m¬≥</li>
                            <li>‚úì <strong>MAPE:</strong> 7.24%</li>
                        </ul>

                        <a href="https://lightgbm.readthedocs.io/" class="btn btn-sm btn-outline-success mt-2" target="_blank">Documentaci√≥n LightGBM</a>
                    </div>
                </div>
            </div>

            <!-- 2. Gradient Boosting Regressor -->
            <div class="col-lg-6">
                <div class="model-card h-100 border-start border-4 border-success">
                    <div class="model-card-header bg-light">
                        <h5 class="model-title text-success mb-0">Gradient Boosting Regressor</h5>
                        <small class="text-muted">Potenciaci√≥n Secuencial de Gradientes</small>
                    </div>
                    <div class="model-card-graphic bg-success bg-opacity-10 rounded d-flex align-items-center justify-content-center" style="height: 120px; min-height: 120px;">
                        <div class="text-center">
                            <div style="font-size: 2.5rem; margin-bottom: 8px;">üìà</div>
                            <p class="small text-muted mb-0"><strong>Mejora</strong></p>
                            <p class="small text-muted mb-0">Iterativa Secuencial</p>
                        </div>
                    </div>
                    <div class="model-card-body">
                        <h6 class="fw-bold">¬øC√≥mo funciona?</h6>
                        <p class="small">Construye √°rboles de forma secuencial. Cada nuevo √°rbol se entrena para corregir los residuos (errores) del √°rbol anterior usando descenso de gradiente. El modelo optimiza el error gradualmente, mejorando paso a paso.</p>

                        <h6 class="fw-bold mt-3">Par√°metros Clave</h6>
                        <ul class="small list-unstyled">
                            <li>‚Ä¢ <strong>n_estimators:</strong> 100 etapas de boosting</li>
                            <li>‚Ä¢ <strong>learning_rate:</strong> 0.1 (tasa de aprendizaje)</li>
                            <li>‚Ä¢ <strong>max_depth:</strong> 3 (profundidad del √°rbol)</li>
                            <li>‚Ä¢ <strong>subsample:</strong> 1.0 (fracci√≥n de muestras)</li>
                        </ul>

                        <h6 class="fw-bold mt-3">Ventajas</h6>
                        <ul class="small">
                            <li>‚úì Excelente precisi√≥n en datos tabulares</li>
                            <li>‚úì Captura interacciones entre features</li>
                            <li>‚úì Penaliza errores grandes progresivamente</li>
                            <li>‚úì Uno de los algoritmos m√°s competitivos</li>
                        </ul>

                        <h6 class="fw-bold mt-3">Desventajas</h6>
                        <ul class="small">
                            <li>‚úó Requiere tuning cuidadoso de hiperpar√°metros</li>
                            <li>‚úó Propenso al overfitting si no se ajusta bien</li>
                            <li>‚úó Tiempo de entrenamiento m√°s largo</li>
                        </ul>

                        <h6 class="fw-bold mt-3">Caso de Uso en el Proyecto</h6>
                        <p class="small">Maximiza la precisi√≥n del modelo de calibraci√≥n al corregir iterativamente los errores de predicci√≥n. Muy efectivo para alcanzar el m√°ximo desempe√±o posible.</p>

                        <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.GradientBoostingRegressor.html" class="btn btn-sm btn-outline-success mt-2" target="_blank">Documentaci√≥n oficial</a>
                    </div>
                </div>
            </div>

            <!-- 3. Support Vector Regressor (SVR) -->
            <div class="col-lg-6">
                <div class="model-card h-100 border-start border-4 border-success">
                    <div class="model-card-header bg-light">
                        <h5 class="model-title text-success mb-0">Support Vector Regressor (SVR)</h5>
                        <small class="text-muted">M√°quinas de Vectores de Soporte</small>
                    </div>
                    <div class="model-card-graphic bg-success bg-opacity-10 rounded d-flex align-items-center justify-content-center" style="height: 120px; min-height: 120px;">
                        <div class="text-center">
                            <div style="font-size: 2.5rem; margin-bottom: 8px;">‚ÜîÔ∏è</div>
                            <p class="small text-muted mb-0"><strong>Hiperpla</strong></p>
                            <p class="small text-muted mb-0">con Margen de Error</p>
                        </div>
                    </div>
                    <div class="model-card-body">
                        <h6 class="fw-bold">¬øC√≥mo funciona?</h6>
                        <p class="small">Busca encontrar una funci√≥n (l√≠nea o hiperplano en espacios dimensionales altos) que mejor se ajuste a los datos, pero permitiendo un margen de error (Œµ) tolerado. Los puntos dentro del margen no son penalizados.</p>

                        <h6 class="fw-bold mt-3">Par√°metros Clave</h6>
                        <ul class="small list-unstyled">
                            <li>‚Ä¢ <strong>kernel:</strong> 'rbf' (Radial Basis Function)</li>
                            <li>‚Ä¢ <strong>C:</strong> 1.0 (penalizaci√≥n de errores)</li>
                            <li>‚Ä¢ <strong>epsilon:</strong> 0.1 (margen de tolerancia)</li>
                            <li>‚Ä¢ <strong>gamma:</strong> 'scale' (influencia de muestras)</li>
                        </ul>

                        <h6 class="fw-bold mt-3">Ventajas</h6>
                        <ul class="small">
                            <li>‚úì Efectivo en espacios de alta dimensi√≥n</li>
                            <li>‚úì Usa funciones kernel para capturar relaciones complejas</li>
                            <li>‚úì Menor uso de memoria que RF o GB</li>
                            <li>‚úì Kernels m√∫ltiples disponibles (lineal, rbf, polinomial)</li>
                        </ul>

                        <h6 class="fw-bold mt-3">Desventajas</h6>
                        <ul class="small">
                            <li>‚úó Interpretabilidad limitada</li>
                            <li>‚úó Requiere normalizaci√≥n de datos</li>
                            <li>‚úó Tuning de C y epsilon es cr√≠tico</li>
                        </ul>

                        <h6 class="fw-bold mt-3">Caso de Uso en el Proyecto</h6>
                        <p class="small">Proporciona un enfoque alternativo y computacionalmente eficiente para la calibraci√≥n, especialmente √∫til si los datos tienen relaciones no lineales complejas.</p>

                        <a href="https://scikit-learn.org/stable/modules/generated/sklearn.svm.SVR.html" class="btn btn-sm btn-outline-success mt-2" target="_blank">Documentaci√≥n oficial</a>
                    </div>
                </div>
            </div>

            <!-- 4. Linear Regression -->
            <div class="col-lg-6">
                <div class="model-card h-100 border-start border-4 border-success">
                    <div class="model-card-header bg-light">
                        <h5 class="model-title text-success mb-0">Linear Regression</h5>
                        <small class="text-muted">Regresi√≥n Lineal Simple</small>
                    </div>
                    <div class="model-card-graphic bg-success bg-opacity-10 rounded d-flex align-items-center justify-content-center" style="height: 120px; min-height: 120px;">
                        <div class="text-center">
                            <div style="font-size: 2.5rem; margin-bottom: 8px;">üìä</div>
                            <p class="small text-muted mb-0"><strong>Relaci√≥n</strong></p>
                            <p class="small text-muted mb-0">Lineal Simple</p>
                        </div>
                    </div>
                    <div class="model-card-body">
                        <h6 class="fw-bold">¬øC√≥mo funciona?</h6>
                        <p class="small">El modelo m√°s fundamental. Asume una relaci√≥n lineal entre variables de entrada y salida: <code>y = w‚ÇÅx‚ÇÅ + w‚ÇÇx‚ÇÇ + b</code>. Ajusta los pesos minimizando el error cuadr√°tico medio mediante m√≠nimos cuadrados ordinarios (OLS).</p>

                        <h6 class="fw-bold mt-3">Par√°metros Clave</h6>
                        <ul class="small list-unstyled">
                            <li>‚Ä¢ <strong>fit_intercept:</strong> True (incluye t√©rmino independiente)</li>
                            <li>‚Ä¢ <strong>normalize:</strong> False (no normaliza)</li>
                            <li>‚Ä¢ <strong>Par√°metros aprendidos:</strong> Pesos para cada feature + sesgo</li>
                        </ul>

                        <h6 class="fw-bold mt-3">Ventajas</h6>
                        <ul class="small">
                            <li>‚úì Extremadamente interpretable</li>
                            <li>‚úì R√°pido de entrenar y predecir</li>
                            <li>‚úì Bajo uso de memoria</li>
                            <li>‚úì Excelente baseline para comparaci√≥n</li>
                        </ul>

                        <h6 class="fw-bold mt-3">Desventajas</h6>
                        <ul class="small">
                            <li>‚úó Asume relaci√≥n lineal (raramente cierto en datos reales)</li>
                            <li>‚úó Sensible a outliers</li>
                            <li>‚úó Mal desempe√±o con relaciones no lineales</li>
                        </ul>

                        <h6 class="fw-bold mt-3">Caso de Uso en el Proyecto</h6>
                        <p class="small"><strong>BASELINE del proyecto:</strong> Proporciona un punto de referencia. Si modelos complejos no mejoran significativamente sobre regresi√≥n lineal, su complejidad adicional no se justifica. Tambi√©n permite entender si la relaci√≥n PM2.5 sensor vs RMCAB es fundamentalmente lineal.</p>

                        <a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html" class="btn btn-sm btn-outline-success mt-2" target="_blank">Documentaci√≥n oficial</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n: Comparaci√≥n General -->
        <div class="row mt-5">
            <div class="col-lg-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Tabla Comparativa de Modelos</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover table-sm">
                                <thead class="table-light">
                                    <tr>
                                        <th>Modelo</th>
                                        <th>Complejidad</th>
                                        <th>Velocidad</th>
                                        <th>Interpretabilidad</th>
                                        <th>Manejo de No-Linealidad</th>
                                        <th>Sobreajuste</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Linear Regression</strong></td>
                                        <td>Muy Baja</td>
                                        <td class="text-success">‚ö° Muy R√°pida</td>
                                        <td class="text-success">Excelente</td>
                                        <td>Pobre</td>
                                        <td>Bajo</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Random Forest</strong></td>
                                        <td>Alta</td>
                                        <td>Moderada</td>
                                        <td>Media</td>
                                        <td class="text-success">Excelente</td>
                                        <td>Muy Bajo</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Gradient Boosting</strong></td>
                                        <td>Muy Alta</td>
                                        <td>Lenta</td>
                                        <td>Pobre</td>
                                        <td class="text-success">Excelente</td>
                                        <td>Bajo-Moderado</td>
                                    </tr>
                                    <tr>
                                        <td><strong>SVR (RBF)</strong></td>
                                        <td>Alta</td>
                                        <td>Moderada</td>
                                        <td>Pobre</td>
                                        <td class="text-success">Muy Buena</td>
                                        <td>Moderado</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n: Pipeline de Selecci√≥n -->
        <div class="row mt-4 mb-5">
            <div class="col-lg-12">
                <div class="card shadow-sm border-info">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">Pipeline de Selecci√≥n del Mejor Modelo</h5>
                    </div>
                    <div class="card-body">
                        <ol class="list-group list-group-numbered">
                            <li class="list-group-item">
                                <strong>Preparaci√≥n de Datos:</strong>
                                <small>Carga de sensores (PostgreSQL) + RMCAB, fusi√≥n, resample a promedios horarios</small>
                            </li>
                            <li class="list-group-item">
                                <strong>Ingenier√≠a de Features:</strong>
                                <small>Selecci√≥n de PM2.5 sensor, Humedad, Temperatura como variables predictoras</small>
                            </li>
                            <li class="list-group-item">
                                <strong>Divisi√≥n Train/Test:</strong>
                                <small>75% datos para entrenamiento, 25% para evaluaci√≥n final</small>
                            </li>
                            <li class="list-group-item">
                                <strong>Entrenamiento de Modelos:</strong>
                                <small>Los 4 modelos se entrenan en paralelo con los mismos datos</small>
                            </li>
                            <li class="list-group-item">
                                <strong>Evaluaci√≥n Integral:</strong>
                                <small>C√°lculo de RMSE, MAE, R¬≤, MAPE para cada modelo</small>
                            </li>
                            <li class="list-group-item">
                                <strong>Selecci√≥n:</strong>
                                <small>El modelo con <strong>menor RMSE</strong> es seleccionado como mejor modelo</small>
                            </li>
                            <li class="list-group-item">
                                <strong>Aplicaci√≥n:</strong>
                                <small>El modelo elegido se utiliza para calibrar nuevas predicciones</small>
                            </li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
